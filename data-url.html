data:text/html;charset=utf-8,<!doctypehtml>
<html>
<head>
<meta charset="utf-8">
<title>MD HackPad</title>
<link rel="icon" 
      href="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22%3E%3Crect%20width=%22100%22%20height=%22100%22%20fill=%22black%22/%3E%3Ctext%20x=%2250%22%20y=%2265%22%20font-size=%2260%22%20text-anchor=%22middle%22%20fill=%22lime%22%20font-family=%22monospace%22%3EMD%3C/text%3E%3C/svg%3E">
<style>
  body {margin:0;background:#000;color:#0f0;font-family:monospace;}
  #bar {display:flex;gap:8px;padding:6px;background:#000;border-bottom:1px solid #0f0;}
  button {background:#000;color:#0f0;border:1px solid #0f0;border-radius:6px;padding:4px 8px;cursor:pointer;}
  textarea,#preview {width:100vw;height:calc(100vh - 40px);box-sizing:border-box;padding:10px;
    background:#000;color:#0f0;border:none;outline:none;font:inherit;line-height:1.5;}
  #preview {overflow:auto;white-space:normal;}
  a{color:#0f0}
  pre,code{background:#010;border:1px solid #0f0;padding:2px 4px}
  pre{padding:8px;overflow:auto}
</style>
</head>
<body>
<div id="bar">
  <button onclick="showEdit()">Edit</button>
  <button onclick="showPrev()">Preview (Ctrl+Enter)</button>
</div>
<textarea id="ta" autofocus placeholder="Enter Markdown..."></textarea>
<div id="preview" style="display:none"></div>
<script>
  const ta=document.getElementById("ta"), pv=document.getElementById("preview"), LSK="mdpad";
  ta.value=localStorage[LSK]||"";
  ta.oninput=()=>localStorage[LSK]=ta.value;

  function esc(s){return s.replace(/[&<>\"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
  function md(s){
    s=esc(s);
    s=s.replace(/^###### (.*)$/gm,"<h6>$1</h6>").replace(/^##### (.*)$/gm,"<h5>$1</h5>")
       .replace(/^#### (.*)$/gm,"<h4>$1</h4>").replace(/^### (.*)$/gm,"<h3>$1</h3>")
       .replace(/^## (.*)$/gm,"<h2>$1</h2>").replace(/^# (.*)$/gm,"<h1>$1</h1>");
    s=s.replace(/```([\s\S]*?)```/g,(m,code)=>"<pre><code>"+code+"</code></pre>");
    s=s.replace(/`([^`]+)`/g,"<code>$1</code>");
    s=s.replace(/\*\*([^*]+)\*\*/g,"<b>$1</b>");
    s=s.replace(/\*([^*]+)\*/g,"<i>$1</i>");
    s=s.replace(/^> (.*)$/gm,"<blockquote>$1</blockquote>");
    s=s.replace(/^[-*] (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>\n?)+/g,m=>"<ul>"+m.replace(/\n/g,"")+"</ul>");
    s=s.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>');
    s=s.replace(/\n\n/g,"<br><br>");
    return s;
  }
  function showEdit(){pv.style.display="none";ta.style.display="block";ta.focus()}
  function showPrev(){pv.innerHTML=md(ta.value);ta.style.display="none";pv.style.display="block"}
  document.addEventListener("keydown",e=>{
    if(e.ctrlKey && e.key==="Enter"){(pv.style.display==="none"?showPrev:showEdit)()}
  });
</script>
</body>
</html>

